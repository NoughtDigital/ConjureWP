var Conjure=function(e){var n,t={install_child:function(e){(new r).init(e)},activate_license:function(e){(new a).init(e)},install_plugins:function(e){(new i).init(e)},install_content:function(e){(new s).init(e)}};function o(){var o,r,a=e(".conjure__body"),i=(e(".conjure__body--loading"),e(".conjure__body--exiting"),e("#conjure__drawer-trigger"));n="conjure__drawer--open",setTimeout(function(){a.addClass("loaded");var n=e(".js-conjure-drawer-import-content"),t=e(".conjure__drawer--import-content__list-item");console.log("=== Conjure Debug - Page Loaded ==="),console.log("Drawer content HTML:",n.html()),console.log("Drawer items count:",t.length),0===t.length&&console.error("ERROR: No import options loaded! Check PHP get_import_data_info() and get_import_steps_html()")},100),i.on("click",function(){a.toggleClass(n);var t=e(".js-conjure-drawer-import-content"),o=e(".conjure__drawer--import-content__list-item");console.log("Conjure Debug - Drawer clicked"),console.log("Drawer content element exists:",t.length>0),console.log("Drawer items count:",o.length),o.length>0?console.log("First drawer item:",o.first().html()):console.log("WARNING: No drawer items found! The import options list is empty.")}),o=document.getElementById("server-health-header"),r=document.getElementById("server-health-info"),o&&r&&o.addEventListener("click",function(){r.classList.toggle("open")}),document.addEventListener("click",function(e){var n=e.target.closest(".conjure__drawer--import-content__list-item");if(n&&!e.target.closest(".conjure__upload-zone")&&!e.target.closest("label")&&"INPUT"!==e.target.tagName){var t=n.querySelector(".js-conjure-upload-checkbox");t&&(e.preventDefault(),t.checked=!t.checked,t.dispatchEvent(new Event("change",{bubbles:!0})))}}),function(){var e=document.querySelectorAll(".conjure__upload-zone");if(0===e.length)return;document.querySelectorAll(".js-conjure-upload-checkbox").forEach(function(e){c(e),e.addEventListener("change",function(){c(e)})}),document.querySelectorAll(".conjure__upload-label").forEach(function(e){e.addEventListener("click",function(n){var t=e.getAttribute("for"),o=document.getElementById(t),r=e.closest(".conjure__drawer--upload__item");o.disabled&&(n.preventDefault(),r.classList.toggle("conjure__drawer--upload__item--expanded"))})}),e.forEach(function(e){var n=e.getAttribute("data-type"),t=e.getAttribute("data-accept");e.addEventListener("click",function(o){if(!o.target.closest(".conjure__remove-file")&&!e.classList.contains("has-file")){o.preventDefault();var r=wp.media({title:"Select "+n+" file",button:{text:"Use this file"},multiple:!1});r.on("select",function(){var e=r.state().get("selection").first().toJSON();(function(e,n,t){if(!e||!e.filename)return l(t,"Invalid file selected."),!1;var o=e.filename.toLowerCase(),r=n.split(",").map(function(e){return e.trim()});if(!r.some(function(e){return o.endsWith(e)})){return l(t,"Invalid file type. Please select a file with one of these extensions: "+r.join(", ")),!1}return!0})(e,t,n)&&function(e,n){var t=document.querySelector('.conjure__upload-zone[data-type="'+n+'"]'),o=t.querySelector(".conjure__upload-progress"),r=t.querySelector(".conjure__upload-prompt"),a=t.querySelector(".conjure__upload-success");r.style.display="none",a.style.display="none",o.style.display="block";var i=new URLSearchParams;i.append("action","conjure_upload_from_media"),i.append("attachment_id",e.id),i.append("file_type",n),i.append("wpnonce",conjure_params.wpnonce),fetch(conjure_params.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()}).then(function(e){return e.json()}).then(function(e){if(e.success){t.classList.add("has-file"),o.style.display="none",t.querySelector(".conjure__file-name").textContent=e.data.filename,t.querySelector(".conjure__file-size").textContent=e.data.size,a.style.display="flex";var i=t.querySelector(".conjure__remove-file");i&&(i.style.display="inline-flex");var s=document.getElementById("default_content_"+n);s.disabled=!1,s.checked=!0,c(s,!0)}else o.style.display="none",r.style.display="flex",l(n,e.data.message||conjure_params.texts.something_went_wrong)}).catch(function(e){o.style.display="none",r.style.display="flex",l(n,"Upload failed: "+(e||conjure_params.texts.something_went_wrong))})}(e,n)}),r.open()}})}),document.addEventListener("click",function(e){e.target.closest(".conjure__remove-file")&&(e.preventDefault(),e.stopPropagation(),function(e){var n=document.querySelector('.conjure__upload-zone[data-type="'+e+'"]'),t=n.querySelector(".conjure__upload-prompt"),o=n.querySelector(".conjure__upload-success"),r=new URLSearchParams;r.append("action","conjure_delete_uploaded_file"),r.append("file_type",e),r.append("wpnonce",conjure_params.wpnonce),fetch(conjure_params.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()}).then(function(e){return e.json()}).then(function(r){if(r.success){n.classList.remove("has-file"),o.style.display="none",t.style.display="flex";var a=n.querySelector(".conjure__remove-file");a&&(a.style.display="none");var i=n.querySelector(".conjure__file-name");i&&(i.textContent="");var s=n.querySelector(".conjure__file-size");s&&(s.textContent="");var u=document.getElementById("default_content_"+e);if(!u)return;"1"===u.dataset.manualUpload?(u.disabled=!0,u.checked=!1,c(u,!1)):c(u,u.checked)}else l(e,r.data.message||conjure_params.texts.something_went_wrong)}).catch(function(n){l(e,"Failed to remove file: "+(n||conjure_params.texts.something_went_wrong))})}(e.target.closest(".conjure__remove-file").getAttribute("data-type")))})}(),e(".conjure__button--proceed:not(.conjure__button--closer)").click(function(e){e.preventDefault();var n=this.getAttribute("href");a.addClass("exiting"),setTimeout(function(){window.location=n},400)}),e(".conjure__button--closer").on("click",function(e){a.removeClass(n),e.preventDefault();var t=this.getAttribute("href");setTimeout(function(){a.addClass("exiting")},600),setTimeout(function(){window.location=t},1100)}),e(".button-next").on("click",function(n){if(n.preventDefault(),!function(e){var n=jQuery(e);if("yes"==n.data("done-loading"))return!1;n.is("input")||n.is("button");return n.data("done-loading","yes"),n.addClass("conjure__button--loading"),{done:function(){n.attr("disabled",!1)}}}(this))return!1;var o=e(this).data("callback");return!o||void 0===t[o]||(t[o](this),!1)}),e(document).on("change",".js-conjure-demo-import-select",function(){var n=e(this).val();e(".js-conjure-select-spinner").show(),e.post(conjure_params.ajaxurl,{action:"conjure_update_selected_import_data_info",wpnonce:conjure_params.wpnonce,selected_index:n},function(n){if(n.success){var t=n.data.import_info_html||n.data;e(".js-conjure-drawer-import-content").html(t),n.data.has_plugins&&n.data.demo_plugins&&(e(".js-conjure-drawer-import-content").data("demo-plugins",n.data.demo_plugins),console&&console.log&&console.log("Demo-specific plugins loaded:",n.data.demo_plugins))}else alert(conjure_params.texts.something_went_wrong);e(".js-conjure-select-spinner").hide()}).fail(function(){e(".js-conjure-select-spinner").hide(),alert(conjure_params.texts.something_went_wrong)})}),e(document).on("change",".js-conjure-demo-select-plugins",function(){var n=e(this).val();n&&e.post(conjure_params.ajaxurl,{action:"conjure_update_selected_import_data_info",wpnonce:conjure_params.wpnonce,selected_index:n},function(e){e.success?window.location.reload():alert(conjure_params.texts.something_went_wrong)}).fail(function(){alert(conjure_params.texts.something_went_wrong)})})}function r(){var t,o=e(".conjure__body"),r=e("#child-theme-text");function a(e){void 0!==e.done?(setTimeout(function(){r.addClass("lead")},0),setTimeout(function(){r.addClass("success"),r.html(e.message)},600),t()):(r.addClass("lead error"),r.html(e.error))}return{init:function(r){t=function(){setTimeout(function(){e(".conjure__body").addClass("js--finished")},1500),o.removeClass(n),setTimeout(function(){e(".conjure__body").addClass("exiting")},3500),setTimeout(function(){window.location.href=r.href},4e3)},jQuery.post(conjure_params.ajaxurl,{action:"conjure_child_theme",wpnonce:conjure_params.wpnonce},a).fail(a)}}}function a(){var t,o=e(".conjure__body"),r=e(".conjure__content--license-key"),a=e("#license-text");function i(n){void 0!==n.success&&n.success?(a.siblings(".error-message").remove(),setTimeout(function(){a.addClass("lead")},0),setTimeout(function(){a.addClass("success"),a.html(n.message)},600),t()):(e(".js-conjure-license-activate-button").removeClass("conjure__button--loading").data("done-loading","no"),a.siblings(".error-message").remove(),r.addClass("has-error"),a.html(n.message),a.siblings(".error-message").addClass("lead error"))}return{init:function(a){t=function(){setTimeout(function(){e(".conjure__body").addClass("js--finished")},1500),o.removeClass(n),setTimeout(function(){e(".conjure__body").addClass("exiting")},3500),setTimeout(function(){window.location.href=a.href},4e3)},r.removeClass("has-error"),jQuery.post(conjure_params.ajaxurl,{action:"conjure_activate_license",wpnonce:conjure_params.wpnonce,license_key:e(".js-license-key").val()},i).fail(i)}}}function i(){var t,o,r=e(".conjure__body"),a=0,i="",s="";function c(e){var n=o.find("label");"object"==typeof e&&void 0!==e.message?(n.removeClass("installing success error").addClass(e.message.toLowerCase()),void 0!==e.completed&&e.completed?(o&&!o.data("done_item")&&(a++,o.data("done_item",1)),t()):void 0!==e.done&&e.done?(o&&!o.data("done_item")&&(a++,o.data("done_item",1)),l()):void 0!==e.url?e.hash==s?(n.removeClass("installing success").addClass("error"),l()):(s=e.hash,jQuery.post(e.url,e,c).fail(c)):l()):(o&&!o.data("done_item")&&(a++,o.data("done_item",1)),l())}function l(){o&&(o.data("done_item")||(a++,o.data("done_item",1)),o.find(".spinner").css("visibility","hidden"));var n=e(".conjure__drawer--install-plugins li[data-slug]:not(.plugin-active)");n.each(function(){var n=e(this);return!!n.data("done_item")||(i=n.data("slug"),o=n,function(){if(i){var e=o.find("input:checkbox"),n=o.find("input[type=hidden]");e.length>0&&e.is(":checked")||n.length>0?jQuery.post(conjure_params.ajaxurl,{action:"conjure_install_plugin",wpnonce:conjure_params.wpnonce,slug:i},c).fail(c):(o.addClass("skipping"),setTimeout(l,300))}}(),!1)}),a>=n.length&&t()}return{init:function(o){e(".conjure__drawer--install-plugins").addClass("installing"),e(".conjure__drawer--install-plugins").find("input").prop("disabled",!0),t=function(){setTimeout(function(){e(".conjure__body").addClass("js--finished")},1e3),r.removeClass(n),setTimeout(function(){e(".conjure__body").addClass("exiting")},3e3),setTimeout(function(){window.location.href=o.href},3500)},l()}}}function s(){var t,o,r,a=e(".conjure__body"),i=0,s="",c="",l=1,u=0;function d(n){var t=o.find("label");"object"==typeof n&&void 0!==n.message?(t.addClass(n.message.toLowerCase()),void 0!==n.num_of_imported_posts&&0<u&&(l="all"===n.num_of_imported_posts?u:n.num_of_imported_posts,p()),void 0!==n.url?n.hash===c?(t.addClass("status--failed"),_()):(c=n.hash,void 0===n.selected_index&&(n.selected_index=e(".js-conjure-demo-import-select").val()||0),jQuery.post(n.url,n,d).fail(d)):(n.done,_())):(console.log(n),t.addClass("status--error"),_())}function _(){var n=!1;o&&(o.data("done_item")||(i++,o.data("done_item",1)),o.find(".spinner").css("visibility","hidden"));var r=e(".conjure__drawer--import-content__list-item");e(".conjure__drawer--import-content__list-item input:checked");r.each(function(){""==s||n?(s=e(this).data("content"),o=e(this),s&&(o.find("input:checkbox").is(":checked")?jQuery.post(conjure_params.ajaxurl,{action:"conjure_content",wpnonce:conjure_params.wpnonce,content:s,selected_index:e(".js-conjure-demo-import-select").val()||0},d).fail(d):(o.addClass("skipping"),setTimeout(_,300))),n=!1):e(this).data("content")==s&&(n=!0)}),i>=r.length&&t()}function p(){e(".js-conjure-progress-bar").css("width",l/u*100+"%");var n,t,o,a=(n=l/u*100,t=0,o=99,Math.min(o,Math.max(t,n)));e(".js-conjure-progress-bar-percentage").html(Math.round(a)+"%"),1===l/u&&clearInterval(r)}return{init:function(o){e(".conjure__drawer--import-content").addClass("installing"),e(".conjure__drawer--import-content").find("input").prop("disabled",!0),t=function(){e.post(conjure_params.ajaxurl,{action:"conjure_import_finished",wpnonce:conjure_params.wpnonce,selected_index:e(".js-conjure-demo-import-select").val()||0}),setTimeout(function(){e(".js-conjure-progress-bar-percentage").html("100%")},100),setTimeout(function(){a.removeClass(n)},500),setTimeout(function(){e(".conjure__body").addClass("js--finished")},1500),setTimeout(function(){e(".conjure__body").addClass("exiting")},3400),setTimeout(function(){window.location.href=o.href},4e3)},function(){if(!e(".conjure__drawer--import-content__list-item .checkbox-content").is(":checked"))return!1;jQuery.post(conjure_params.ajaxurl,{action:"conjure_get_total_content_import_items",wpnonce:conjure_params.wpnonce,selected_index:e(".js-conjure-demo-import-select").val()||0},function(e){0<(u=e.data)&&(p(),r=setInterval(function(){l+=u/500,p()},1e3))})}(),_()}}}function c(e,n){if(e){var t=e.closest(".conjure__drawer--upload__item");if(t)("boolean"==typeof n?n:e.checked)?t.classList.add("conjure__drawer--upload__item--expanded"):t.classList.remove("conjure__drawer--upload__item--expanded")}}function l(e,n){var t=document.querySelector('.conjure__upload-zone[data-type="'+e+'"]');if(t){var o=t.querySelector(".conjure__upload-error");o&&o.remove(),t.classList.add("conjure__upload-zone--error");var r=document.createElement("div");r.className="conjure__upload-error",r.textContent=n;var a=t.querySelector(".conjure__upload-prompt");a&&a.after(r),setTimeout(function(){r.style.opacity="0",r.style.transition="opacity 0.3s",setTimeout(function(){r.remove()},300),t.classList.remove("conjure__upload-zone--error")},5e3)}}return{init:function(){e(o)},callback:function(e){console.log(e),console.log(this)}}}(jQuery);Conjure.init();